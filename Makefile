PWD!=pwd -P | sed 's/^\/mnt//'
DOCKER=docker run -v "$(PWD):/srv" -w=/srv nowox/latex:1.0

all: refcard.tex revision.tex
	$(DOCKER) latexmk -pdf -xelatex $<

revision.tex:
	echo "% Autogenerated, do not edit" > $@
	echo "\\\\newcommand{\\\\revisiondate}{`git log -1 --format=\"%ad\" --date=short`}" >> $@
	echo "\\\\newcommand{\\\\revision}{`git describe`}" >> $@

clean:
	$(DOCKER) latexmk -C

.PHONY: clean
